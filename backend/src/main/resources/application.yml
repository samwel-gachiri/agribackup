#spring.application.name=farmers-portal-apis
server:
  port: 8080
  servlet:
    context-path: /
  address: 0.0.0.0

spring:
  application:
    name: farmers-service-api
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:mysql}

  datasource:
    url: ${DB_URL}
    username: ${DB_USER}
    password: ${DB_PASS}
    driver-class-name: ${DB_DRIVER_CLASS:com.mysql.cj.jdbc.Driver}
  jpa:
    open-in-view: false
    generate-ddl: false
    show-sql: true
    hibernate:
      ddl-auto: none
      cache:
        use_second_level_cache: true
        region.factory_class: org.hibernate.cache.jcache.JCacheRegionFactory
    properties:
      hibernate:
        dialect: ${HIBERNATE_DIALECT:org.hibernate.dialect.MySQL8Dialect}
        jdbc:
          time_zone: UTC
  autoconfigure:
    exclude:
#      - org.springframework.cloud.aws.autoconfigure.context.ContextStackAutoConfiguration
#      - org.springframework.cloud.aws.autoconfigure.context.ContextRegionProviderAutoConfiguration
  liquibase:
    enabled: true
    change-log: classpath:/db/changelog/db.changelog-master.yml
    driver-class-name: com.mysql.cj.jdbc.Driver
  mail:
    host: smtp.gmail.com
    port: 587
    username: agribackupltd@gmail.com
    password: ${EMAIL_APP_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
  devtools:
    livereload:
      enabled: false
    restart:
      enabled: false
  trigger-file: .restart-trigger


  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
    anthropic:
      api-key: ${ANTHROPIC_API_KEY}
    ollama:
      chat:
        options:
          model: deepseek-r1:latest
#  level:
#    liquibase: DEBUG

aws:
  accessKey: ${AWS_ACCESS_KEY_ID}
  secretKey: ${AWS_SECRET_ACCESS_KEY}
  region: us-east-1
  bucketName: agri-image

twilio:
  account-sid: ${TWILIO_ACCOUNT_SID:sid}
  auth-token: ${TWILIO_AUTH_TOKEN:tok}
  phone-number: ${TWILIO_PHONE_NUMBER:kd}
textsms:
  apikey: ${TEXTSMS_API_KEY}
  partnerID: ${TEXTSMS_PARTNER_ID}
  shortcode: TextSMS
#cloud:
#  aws:
#    stack:
#      auto: false
#    credentials:
#      accessKey: ${AWS_ACCESS_KEY_ID}
#      secretKey: ${AWS_SECRET_ACCESS_KEY}
#    region:
#      static: us-east-1

springdoc:
  swagger-ui:
    tags-sorter: alpha
    operations-sorter: alpha
    enabled: true
  api-docs:
    path: /v3/api-docs
  paths-to-match: /api/**,/farmers-service/**,/buyers-service/**,/connection-service/**

elevenlabs:
  api:
    key: ${ELEVENLABS_API_KEY}
  voice:
    id: pFZP5JQG7iQjIQuC4Bku
maps:
  api:
    key: ${MAPS_API_KEY}
google:
  api:
    key: ${GOOGLE_API_KEY}

jwt:
  secret: ${JWT_SECRET}
  expiration: 86400

# Hedera DLT Configuration
hedera:
  network:
    type: ${HEDERA_NETWORK_TYPE:testnet}
    endpoint: ${HEDERA_NETWORK_ENDPOINT:https://testnet.mirrornode.hedera.com}
  account:
    id: ${HEDERA_ACCOUNT_ID}
    private-key: ${HEDERA_PRIVATE_KEY}
  consensus:
    topic-id: ${HEDERA_CONSENSUS_TOPIC_ID}
  retry:
    max-attempts: 3
    backoff-delay: 1000

# IPFS Configuration
# Set IPFS_ENABLED=true and provide IPFS_API_KEY and IPFS_API_SECRET to enable IPFS document storage
ipfs:
  enabled: ${IPFS_ENABLED:false}
  gateway:
    url: ${IPFS_GATEWAY_URL:https://ipfs.io}
  api:
    url: ${IPFS_API_URL:https://api.pinata.cloud}
    key: ${IPFS_API_KEY:}
    secret: ${IPFS_API_SECRET:}

# Global Forest Watch Configuration
gfw:
  api:
    base-url: ${GFW_API_BASE_URL:https://data-api.globalforestwatch.org}
    key: 792ac27e-920f-4b6b-bfda-d40df10438f0

# Deforestation Monitoring Configuration
deforestation:
  monitoring:
    enabled: ${DEFORESTATION_MONITORING_ENABLED:true}
  buffer:
    distance:
      km: ${DEFORESTATION_BUFFER_DISTANCE_KM:5.0}
  use-satellite-imagery: ${USE_SATELLITE_IMAGERY:true}  # true = Sentinel/Landsat, false = GFW

# Google Earth Engine Configuration (for Sentinel-2 and Landsat)
# IMPORTANT: Set these environment variables to enable satellite imagery:
#   EARTH_ENGINE_ENABLED=true
#   EARTH_ENGINE_PROJECT_ID=your-actual-gcp-project-id
#   EARTH_ENGINE_CREDENTIALS_PATH=G:/source/key/agribackup-cloud.json
earth-engine:
  enabled: ${EARTH_ENGINE_ENABLED:false}  # Disabled by default - requires setup
  project-id: ${EARTH_ENGINE_PROJECT_ID:}
  credentials-path: ${EARTH_ENGINE_CREDENTIALS_PATH:}
  api:
    base-url: ${EARTH_ENGINE_API_URL:https://earthengine.googleapis.com}

# Sentinel-2 Analysis Configuration
sentinel:
  analysis:
    ndvi-deforestation-threshold: ${SENTINEL_NDVI_THRESHOLD:0.3}     # NDVI < 0.3 = deforested
    ndvi-change-threshold: ${SENTINEL_NDVI_CHANGE_THRESHOLD:-0.2}    # 20% vegetation loss
    baseline-months: ${SENTINEL_BASELINE_MONTHS:3}                   # Baseline period before EUDR cutoff
    recent-days: ${SENTINEL_RECENT_DAYS:10}                          # Recent imagery period

# Landsat 8/9 Analysis Configuration
landsat:
  analysis:
    ndvi-deforestation-threshold: ${LANDSAT_NDVI_THRESHOLD:0.3}
    ndvi-change-threshold: ${LANDSAT_NDVI_CHANGE_THRESHOLD:-0.2}
    baseline-months: ${LANDSAT_BASELINE_MONTHS:3}
    recent-days: ${LANDSAT_RECENT_DAYS:16}                           # Longer period due to 16-day revisit

# EU TRACES NT Configuration (EUDR Due Diligence Statement)
# Set TRACES_NT_ENABLED=true to enable direct API submission
traces-nt:
  enabled: ${TRACES_NT_ENABLED:false}
  environment: ${TRACES_NT_ENVIRONMENT:acceptance}
  base-url:
    acceptance: https://webgate.acceptance.ec.europa.eu/tracesnt-alpha
    production: https://webgate.ec.europa.eu/tracesnt
  api-version: 2
  auth:
    username: ${TRACES_NT_USERNAME:}
    auth-key: ${TRACES_NT_AUTH_KEY:}
  timeout:
    connect-ms: 30000
    read-ms: 60000

# Logging Configuration
logging:
  level:
    root: INFO
    com.agriconnect.farmersportalapis.service.supplychain.DeforestationAlertService: DEBUG
    org.springframework.web.client.RestTemplate: DEBUG

---
# PostgreSQL with PostGIS Profile
spring:
  config:
    activate:
      on-profile: postgresql
  datasource:
    driver-class-name: org.postgresql.Driver
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.spatial.dialect.postgis.PostgisPG95Dialect
  liquibase:
    driver-class-name: org.postgresql.Driver

---
# MySQL Profile (Default)
spring:
  config:
    activate:
      on-profile: mysql
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
  liquibase:
    driver-class-name: com.mysql.cj.jdbc.Driver

